{"version":3,"file":"vuex-router-history.es.js","sources":["../src/index.js"],"sourcesContent":["import createProxy from 'create-proxy'\r\n\r\nconst ROUTE_CHANGED = 'ROUTE_CHANGED'\r\nconst STACK_CHANGED_PUSH = 'STACK_CHANGED_PUSH'\r\nconst STACK_CHANGED_REPLACE = 'STACK_CHANGED_REPLACE'\r\nconst STACK_CHANGED_GO = 'STACK_CHANGED_GO'\r\nconst STACK_CHANGED_BACK = 'STACK_CHANGED_BACK'\r\nconst STACK_CHANGED_FORWARD = 'STACK_CHANGED_FORWARD'\r\n\r\nexport function sync (store, router, options) {\r\n  const moduleName = (options || {}).moduleName || 'history'\r\n  const currentRoute = cloneRoute(router.currentRoute)\r\n\r\n  const getMutationName = name => `${moduleName}/${name}`\r\n\r\n  const handleRouterGo = (state, n) => {\r\n    const targetIndex = state.index + n\r\n    if (targetIndex < 0 || targetIndex >= this.stack.length) return\r\n    const route = state.stack[targetIndex]\r\n    state.current = route\r\n  }\r\n\r\n  store.registerModule(moduleName, {\r\n    namespaced: true,\r\n    state: {\r\n      stack: [currentRoute],\r\n      current: currentRoute,\r\n      index: -1\r\n    },\r\n    mutations: {\r\n      [ROUTE_CHANGED] (state, { to, from }) {\r\n        state.current = cloneRoute(to, from)\r\n      },\r\n      [STACK_CHANGED_PUSH] (state, route) {\r\n        state.stack.push(route)\r\n        state.index++\r\n      },\r\n      [STACK_CHANGED_REPLACE] (state, route) {\r\n        state.stack = state.stack.slice(0, state.index).concat(route)\r\n      },\r\n      [STACK_CHANGED_GO] (state, [n]) {\r\n        handleRouterGo(state, n)\r\n      },\r\n      [STACK_CHANGED_BACK] (state) {\r\n        handleRouterGo(state, -1)\r\n      },\r\n      [STACK_CHANGED_FORWARD] (state) {\r\n        handleRouterGo(state, 1)\r\n      }\r\n    }\r\n  })\r\n\r\n  // sync store on router navigation\r\n  router.afterEach((to, from) => {\r\n    store.commit(moduleName + '/ROUTE_CHANGED', { to, from })\r\n  })\r\n\r\n  const pRouter = createProxy(router, {\r\n    push: {\r\n      apply (target, thisArg, [route]) {\r\n        target.apply(thisArg, [route, () => {\r\n          store.commit(getMutationName(STACK_CHANGED_PUSH), route)\r\n        }])\r\n      }\r\n    },\r\n    replace: {\r\n      apply (target, thisArg, [route]) {\r\n        target.apply(thisArg, [route, () => {\r\n          store.commit(getMutationName(STACK_CHANGED_REPLACE), route)\r\n        }])\r\n      }\r\n    },\r\n    go: {\r\n      apply (target, thisArg, args) {\r\n        target.apply(thisArg, args)\r\n        store.commit(getMutationName(STACK_CHANGED_GO), args)\r\n      }\r\n    },\r\n    back: {\r\n      apply (target, thisArg, args) {\r\n        target.apply(thisArg, args)\r\n        store.commit(getMutationName(STACK_CHANGED_BACK))\r\n      }\r\n    },\r\n    forward: {\r\n      apply (target, thisArg, args) {\r\n        target.apply(thisArg, args)\r\n        store.commit(getMutationName(STACK_CHANGED_FORWARD))\r\n      }\r\n    }\r\n  })\r\n\r\n  return pRouter\r\n}\r\n\r\nfunction cloneRoute (to, from) {\r\n  const clone = {\r\n    name: to.name,\r\n    path: to.path,\r\n    hash: to.hash,\r\n    query: to.query,\r\n    params: to.params,\r\n    fullPath: to.fullPath,\r\n    meta: to.meta\r\n  }\r\n  if (from) {\r\n    clone.from = cloneRoute(from)\r\n  }\r\n  return Object.freeze(clone)\r\n}\r\n"],"names":["const","ROUTE_CHANGED","STACK_CHANGED_PUSH","STACK_CHANGED_REPLACE","STACK_CHANGED_GO","STACK_CHANGED_BACK","STACK_CHANGED_FORWARD","sync","store","router","options","moduleName","currentRoute","cloneRoute","getMutationName","name","handleRouterGo","state","n","targetIndex","index","this","stack","length","current","registerModule","namespaced","mutations","ref","route","push","slice","concat","afterEach","to","from","commit","createProxy","apply","target","thisArg","replace","go","args","back","forward","clone","path","hash","query","params","fullPath","meta","Object","freeze"],"mappings":"4BAEAA,IAAMC,EAAgB,gBAChBC,EAAqB,qBACrBC,EAAwB,wBACxBC,EAAmB,mBACnBC,EAAqB,qBACrBC,EAAwB,wBAE9B,SAAgBC,EAAMC,EAAOC,EAAQC,gBAC7BC,GAAcD,OAAeC,YAAc,UAC3CC,EAAeC,EAAWJ,EAAOG,cAEjCE,WAAkBC,UAAWJ,MAAcI,GAE3CC,WAAkBC,EAAOC,GAC7BlB,IAAMmB,EAAcF,EAAMG,MAAQF,EAC9BC,EAAc,GAAKA,GAAeE,EAAKC,MAAMC,SAEjDN,EAAMO,QADQP,EAAMK,MAAMH,KA0E5B,OAtEAX,EAAMiB,eAAed,GACnBe,YAAY,EACZT,OACEK,OAAQV,GACRY,QAASZ,EACTQ,OAAQ,GAEVO,kBACG1B,YAAgBgB,EAAOW,GACtBX,EAAMO,QAAUX,kBAEjBX,YAAqBe,EAAOY,GAC3BZ,EAAMK,MAAMQ,KAAKD,GACjBZ,EAAMG,WAEPjB,YAAwBc,EAAOY,GAC9BZ,EAAMK,MAAQL,EAAMK,MAAMS,MAAM,EAAGd,EAAMG,OAAOY,OAAOH,MAExDzB,YAAmBa,EAAOW,GACzBZ,EAAeC,WAEhBZ,YAAqBY,GACpBD,EAAeC,GAAQ,MAExBX,YAAwBW,GACvBD,EAAeC,EAAO,SAM5BR,EAAOwB,mBAAWC,EAAIC,GACpB3B,EAAM4B,OAAOzB,EAAa,qBAAoBuB,OAAIC,MAGpCE,EAAY5B,GAC1BqB,MACEQ,eAAOC,EAAQC,EAASZ,OAACC,OACvBU,EAAOD,MAAME,GAAUX,aACrBrB,EAAM4B,OAAOtB,EAAgBZ,GAAqB2B,QAIxDY,SACEH,eAAOC,EAAQC,EAASZ,OAACC,OACvBU,EAAOD,MAAME,GAAUX,aACrBrB,EAAM4B,OAAOtB,EAAgBX,GAAwB0B,QAI3Da,IACEJ,eAAOC,EAAQC,EAASG,GACtBJ,EAAOD,MAAME,EAASG,GACtBnC,EAAM4B,OAAOtB,EAAgBV,GAAmBuC,KAGpDC,MACEN,eAAOC,EAAQC,EAASG,GACtBJ,EAAOD,MAAME,EAASG,GACtBnC,EAAM4B,OAAOtB,EAAgBT,MAGjCwC,SACEP,eAAOC,EAAQC,EAASG,GACtBJ,EAAOD,MAAME,EAASG,GACtBnC,EAAM4B,OAAOtB,EAAgBR,QAQrC,SAASO,EAAYqB,EAAIC,GACvBnC,IAAM8C,GACJ/B,KAAMmB,EAAGnB,KACTgC,KAAMb,EAAGa,KACTC,KAAMd,EAAGc,KACTC,MAAOf,EAAGe,MACVC,OAAQhB,EAAGgB,OACXC,SAAUjB,EAAGiB,SACbC,KAAMlB,EAAGkB,MAKX,OAHIjB,IACFW,EAAMX,KAAOtB,EAAWsB,IAEnBkB,OAAOC,OAAOR"}