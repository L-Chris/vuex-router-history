{"version":3,"file":"vuex-router-history.js","sources":["../src/index.js"],"sourcesContent":["import createProxy from 'create-proxy'\r\n\r\nconst ROUTE_CHANGED = 'ROUTE_CHANGED'\r\nconst STACK_CHANGED_PUSH = 'STACK_CHANGED_PUSH'\r\nconst STACK_CHANGED_REPLACE = 'STACK_CHANGED_REPLACE'\r\nconst STACK_CHANGED_GO = 'STACK_CHANGED_GO'\r\nconst STACK_CHANGED_BACK = 'STACK_CHANGED_BACK'\r\nconst STACK_CHANGED_FORWARD = 'STACK_CHANGED_FORWARD'\r\n\r\nexport function sync (store, router, options) {\r\n  const moduleName = (options || {}).moduleName || 'history'\r\n  const currentRoute = cloneRoute(router.currentRoute)\r\n\r\n  const getMutationName = name => `${moduleName}/${name}`\r\n\r\n  const handleRouterGo = (state, n) => {\r\n    const targetIndex = state.index + n\r\n    if (targetIndex < 0 || targetIndex >= this.stack.length) return\r\n    const route = state.stack[targetIndex]\r\n    state.current = route\r\n  }\r\n\r\n  store.registerModule(moduleName, {\r\n    namespaced: true,\r\n    state: {\r\n      stack: [currentRoute],\r\n      current: currentRoute,\r\n      index: -1\r\n    },\r\n    mutations: {\r\n      [ROUTE_CHANGED] (state, { to, from }) {\r\n        state.current = cloneRoute(to, from)\r\n      },\r\n      [STACK_CHANGED_PUSH] (state, route) {\r\n        state.stack.push(route)\r\n        state.index++\r\n      },\r\n      [STACK_CHANGED_REPLACE] (state, route) {\r\n        state.stack = state.stack.slice(0, state.index).concat(route)\r\n      },\r\n      [STACK_CHANGED_GO] (state, [n]) {\r\n        handleRouterGo(state, n)\r\n      },\r\n      [STACK_CHANGED_BACK] (state) {\r\n        handleRouterGo(state, -1)\r\n      },\r\n      [STACK_CHANGED_FORWARD] (state) {\r\n        handleRouterGo(state, 1)\r\n      }\r\n    }\r\n  })\r\n\r\n  // sync store on router navigation\r\n  router.afterEach((to, from) => {\r\n    store.commit(moduleName + '/ROUTE_CHANGED', { to, from })\r\n  })\r\n\r\n  const pRouter = createProxy(router, {\r\n    push: {\r\n      apply (target, thisArg, [route]) {\r\n        target.apply(thisArg, [route, () => {\r\n          store.commit(getMutationName(STACK_CHANGED_PUSH), route)\r\n        }])\r\n      }\r\n    },\r\n    replace: {\r\n      apply (target, thisArg, [route]) {\r\n        target.apply(thisArg, [route, () => {\r\n          store.commit(getMutationName(STACK_CHANGED_REPLACE), route)\r\n        }])\r\n      }\r\n    },\r\n    go: {\r\n      apply (target, thisArg, args) {\r\n        target.apply(thisArg, args)\r\n        store.commit(getMutationName(STACK_CHANGED_GO), args)\r\n      }\r\n    },\r\n    back: {\r\n      apply (target, thisArg, args) {\r\n        target.apply(thisArg, args)\r\n        store.commit(getMutationName(STACK_CHANGED_BACK))\r\n      }\r\n    },\r\n    forward: {\r\n      apply (target, thisArg, args) {\r\n        target.apply(thisArg, args)\r\n        store.commit(getMutationName(STACK_CHANGED_FORWARD))\r\n      }\r\n    }\r\n  })\r\n\r\n  return pRouter\r\n}\r\n\r\nfunction cloneRoute (to, from) {\r\n  const clone = {\r\n    name: to.name,\r\n    path: to.path,\r\n    hash: to.hash,\r\n    query: to.query,\r\n    params: to.params,\r\n    fullPath: to.fullPath,\r\n    meta: to.meta\r\n  }\r\n  if (from) {\r\n    clone.from = cloneRoute(from)\r\n  }\r\n  return Object.freeze(clone)\r\n}\r\n"],"names":["ROUTE_CHANGED","STACK_CHANGED_PUSH","STACK_CHANGED_REPLACE","STACK_CHANGED_GO","STACK_CHANGED_BACK","STACK_CHANGED_FORWARD","cloneRoute","to","from","const","clone","name","path","hash","query","params","fullPath","meta","Object","freeze","store","router","options","moduleName","currentRoute","getMutationName","handleRouterGo","state","n","targetIndex","index","this","stack","length","current","registerModule","namespaced","mutations","ref","route","push","slice","concat","afterEach","commit","createProxy","apply","target","thisArg","replace","go","args","back","forward"],"mappings":"mFAEMA,EAAgB,gBAChBC,EAAqB,qBACrBC,EAAwB,wBACxBC,EAAmB,mBACnBC,EAAqB,qBACrBC,EAAwB,wBAwF9B,SAASC,EAAYC,EAAIC,GACvBC,IAAMC,GACJC,KAAMJ,EAAGI,KACTC,KAAML,EAAGK,KACTC,KAAMN,EAAGM,KACTC,MAAOP,EAAGO,MACVC,OAAQR,EAAGQ,OACXC,SAAUT,EAAGS,SACbC,KAAMV,EAAGU,MAKX,OAHIT,IACFE,EAAMF,KAAOF,EAAWE,IAEnBU,OAAOC,OAAOT,gBAnGvB,SAAsBU,EAAOC,EAAQC,gBAC7BC,GAAcD,OAAeC,YAAc,UAC3CC,EAAelB,EAAWe,EAAOG,cAEjCC,WAAkBd,UAAWY,MAAcZ,GAE3Ce,WAAkBC,EAAOC,GAC7BnB,IAAMoB,EAAcF,EAAMG,MAAQF,EAC9BC,EAAc,GAAKA,GAAeE,EAAKC,MAAMC,SAEjDN,EAAMO,QADQP,EAAMK,MAAMH,KA0E5B,OAtEAT,EAAMe,eAAeZ,GACnBa,YAAY,EACZT,OACEK,OAAQR,GACRU,QAASV,EACTM,OAAQ,GAEVO,kBACGrC,YAAgB2B,EAAOW,GACtBX,EAAMO,QAAU5B,kBAEjBL,YAAqB0B,EAAOY,GAC3BZ,EAAMK,MAAMQ,KAAKD,GACjBZ,EAAMG,WAEP5B,YAAwByB,EAAOY,GAC9BZ,EAAMK,MAAQL,EAAMK,MAAMS,MAAM,EAAGd,EAAMG,OAAOY,OAAOH,MAExDpC,YAAmBwB,EAAOW,GACzBZ,EAAeC,WAEhBvB,YAAqBuB,GACpBD,EAAeC,GAAQ,MAExBtB,YAAwBsB,GACvBD,EAAeC,EAAO,SAM5BN,EAAOsB,mBAAWpC,EAAIC,GACpBY,EAAMwB,OAAOrB,EAAa,qBAAoBhB,OAAIC,MAGpCqC,EAAYxB,GAC1BmB,MACEM,eAAOC,EAAQC,EAASV,OAACC,OACvBQ,EAAOD,MAAME,GAAUT,aACrBnB,EAAMwB,OAAOnB,EAAgBxB,GAAqBsC,QAIxDU,SACEH,eAAOC,EAAQC,EAASV,OAACC,OACvBQ,EAAOD,MAAME,GAAUT,aACrBnB,EAAMwB,OAAOnB,EAAgBvB,GAAwBqC,QAI3DW,IACEJ,eAAOC,EAAQC,EAASG,GACtBJ,EAAOD,MAAME,EAASG,GACtB/B,EAAMwB,OAAOnB,EAAgBtB,GAAmBgD,KAGpDC,MACEN,eAAOC,EAAQC,EAASG,GACtBJ,EAAOD,MAAME,EAASG,GACtB/B,EAAMwB,OAAOnB,EAAgBrB,MAGjCiD,SACEP,eAAOC,EAAQC,EAASG,GACtBJ,EAAOD,MAAME,EAASG,GACtB/B,EAAMwB,OAAOnB,EAAgBpB"}